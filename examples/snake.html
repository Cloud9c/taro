<!DOCTYPE html>
<html lang='en'>
	<head>
		<meta charset='UTF-8' />
		<meta name='viewport' content='width=device-width,initial-scale=1' />
		<title>Snake</title>
		<link rel="shortcut icon" href="../files/favicon.ico" />
		<link rel="stylesheet" href="examples.css" />
	</head>
	<body>
		<canvas id='canvas'></canvas>
		<!-- Import maps polyfill -->
		<!-- Remove this when import maps will be widely supported -->
		<script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>

		<script type="importmap">
			{
				"imports": {
					"taro": "../build/taro.module.js",
					"three": "../build/taro.module.js"
				}
			}
		</script>

		<script type='module'>
			import * as TARO from 'taro';
			import { OrbitControls } from './jsm/controls/OrbitControls.js'

			let entity, geo, mat, mesh;

			const app = new TARO.App({canvas: document.getElementById('canvas')});
			const scene = new TARO.Scene();
			app.setScene(scene);
			scene.background = new TARO.Color( 0xe0e0e0 );

			// lighting
			entity = new TARO.Entity();
			entity.addComponent('light', {type: 'hemisphere', intensity: 0.6});
			entity.position.set(0, 100, 0);

			entity = new TARO.Entity();
			entity.addComponent('light', {type: 'directional'});
			entity.position.set(-100, 175, 100);

			// floor
			const grid = new TARO.GridHelper( 200, 40, 0x000000, 0x000000 );
			grid.material.opacity = 0.2;
			grid.material.transparent = true;
			grid.rotation.set(Math.PI / 2, 0, 0);

			entity = new TARO.Entity('floor');
			entity.addComponent('renderable', grid);
			entity.addComponent('rigidbody', { type: 'static' })
			entity.addComponent('shape', { type: 'plane' });
			entity.rotation.set(-Math.PI / 2, 0, 0);

			// ball
			geo = new TARO.SphereGeometry(1, 32, 32);
			mat = new TARO.MeshPhongMaterial({ color: 0xffff00 });
			mesh = new TARO.Mesh(geo, mat);
			entity = new TARO.Entity('ball');
			entity.addComponent('renderable', mesh);
			entity.position.set(0, 5, 2);
			entity.addComponent('rigidbody', { mass: 1 });
			entity.addComponent('shape', { type: 'sphere', radius: 1 });

			// blocks
			const position = new TARO.Vector3(-2, 1, -5);
			geo = new TARO.BoxBufferGeometry(1, 1, 1);
			mat = new TARO.MeshPhongMaterial({ color: 0x2194ce });
			let last;
			for (let k = 0; k < 5; k++) {
				for (let i = 0; i < 5; i++) {
					for (let j = 0; j < 5; j++) {
						entity = new TARO.Entity();
						mesh = new TARO.Mesh(geo, mat);
						entity.addComponent('renderable', mesh);
						entity.position.copy(position);
						entity.addComponent('rigidbody', { mass: 0.01 });
						entity.addComponent('shape');
						position.x += 1;

						if (last !== undefined)
							entity.addComponent('constraint', {type: 'hinge', connectedBody: last})

						last = entity;
					}
					position.y += 1;
					position.x = -2;
				}
				position.y = 1;
				position.z += 1;
			}

			// camera
			entity = new TARO.Entity('camera');
			const camera = entity.addComponent('camera').ref;
			camera.position.set(40, 40, 30);
			const controls = new OrbitControls( camera, app.renderer.domElement );
			controls.maxPolarAngle = Math.PI * 0.5;

			// start the app
			app.start();
		</script>
	</body>
</html>
